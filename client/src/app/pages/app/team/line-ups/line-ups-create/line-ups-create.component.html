<div class="row">
    <div class="col-12 col-lg-6 mn-3">
        <div class="d-flex align-items-center mb-3">
            <label
                class="me-3"
                for="selectFormation"
            >
                Formation:
            </label>
            <nz-select
                #selectFormation
                nzSize="large"
                [(ngModel)]="formation"
            >
                <nz-option
                    *ngFor="let formationItem of formations | keyvalue"
                    [nzValue]="formationItem.value"
                    [nzLabel]="formationItem.value"
                >
                </nz-option>
            </nz-select>
        </div>
        <div class="d-flex align-items-center mb-3">
            <label
                class="me-3"
                for="name"
            >
                Name:
            </label>
            <app-small-custom-input
                class="w-100"
                className="w-100"
                (changeValueEvent)="name = $event"
                name="name"
                placeholder="Lineup name"
            >
            </app-small-custom-input>
        </div>
        <div
            *ngFor="let item of selection; let i = index;"
            class="w-100 border d-flex align-items-center op-7"
            role="button"
            data-bs-toggle="modal"
            data-bs-target="#addPlayerModal"
            (click)="selectedPosition = i"
        >
            <div class="p-3 {{getColor(i)}} text-white">
                {{getPosition(i)}}
            </div>
            <div class="ms-3 shorten-text">
                {{item.name || 'Click here to add a player'}}
            </div>
        </div>
        <button
            class="btn bg-purple fw-6 my-4 py-3 text-white br-3 w-100"
            (click)="submit()"
        >
            Submit
        </button>
    </div>
    <div class="field col-12 col-lg-6 mb-3 d-flex flex-column justify-content-end align-items-center">
        <div class="w-75 py-6 d-flex align-items-center justify-content-around">
            <span
                class="player"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#addPlayerModal"
                (click)="selectedPosition = 4"
            >
                5
            </span>
            <span
                *ngIf="formation !== formations['1-3-1']"
                class="player"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#addPlayerModal"
                (click)="selectedPosition = 3"
            >
                4
            </span>
            <span
                *ngIf="formation === formations['1-1-3']"
                class="player"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#addPlayerModal"
                (click)="selectedPosition = 2"
            >
                3
            </span>
        </div>
        <div class="w-100 py-6 d-flex align-items-center justify-content-around">
            <span
                *ngIf="formation === formations['1-3-1']"
                class="player"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#addPlayerModal"
                (click)="selectedPosition = 3"
            >
                4
            </span>
            <span
                *ngIf="formation !== formations['1-1-3']"
                class="player"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#addPlayerModal"
                (click)="selectedPosition = 2"
            >
                3
            </span>
            <span
                class="player"
                role="button"
                data-bs-toggle="modal"
                data-bs-target="#addPlayerModal"
                (click)="selectedPosition = 1"
            >
                2
            </span>
        </div>
        <span
            class="player"
            role="button"
            data-bs-toggle="modal"
            data-bs-target="#addPlayerModal"
            (click)="selectedPosition = 0"
        >
            1
        </span>
    </div>
</div>

<div
    class="modal fade"
    id="addPlayerModal"
    data-bs-keyboard="false"
    tabindex="-1"
    aria-labelledby="addPlayerModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content br-3">
            <button
                type="button"
                class="btn-close position-absolute"
                data-bs-dismiss="modal"
                aria-label="Close"
                role="button"
                data-bs-target="#addPlayerModal"
            >
            </button>
            <div class="modal-body py-5 px-5">
                <h3 class="mb-2">Add player</h3>
                <div class="line bg-secondary mb-3"></div>
                <ng-template [ngIf]="!loading" [ngIfElse]="loadingTemplate" >
                    <ng-template [ngIf]="unusedPlayers().length > 0" [ngIfElse]="empty" >
                        <div
                            *ngFor="let player of unusedPlayers(); let i = index"
                            class="w-100 p-3 d-flex align-items-center {{i !== 0 ? 'border-top' : ''}} {{player.player_id == selectedPlayer ? 'bg-purple-bg' : ''}}"
                            role="button"
                            (click)="selectPlayer(player.player_id)"
                        >
                            <nz-avatar
                                nzIcon="team"
                                [nzSize]="48"
                                nzShape="circle"
                                [nzSrc]="assetsUrl + player.player.thumbnail"
                                [nzAlt]="'logo' + player.player.name + ' ' + player.player.surname"
                            >
                            </nz-avatar>
                            <span class="h6 mb-0 ms-3 text-uppercase shorten-text">
                                {{player.player.name}} {{player.player.surname}}
                            </span>
                        </div>
                    </ng-template>
                </ng-template>
            </div>
            <div class="modal-footer">
                <div class="w-100 row">
                    <div class="col-8 d-flex align-items-center justify-content-center">
                        <app-small-custom-input
                            class="w-100"
                            className="w-100"
                            (changeValueEvent)="customName = $event"
                            placeholder="Player name"
                        >
                        </app-small-custom-input>
                    </div>
                    <div class="col-4 d-flex align-items-center justify-content-end">
                        <button
                            class="btn op-7 bg-purple text-white br-3"
                            role="button"
                            data-bs-target="#addPlayerModal"
                            data-bs-dismiss="modal"
                            (click)="addPlayer()"
                        >
                            Add Player
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template #loadingTemplate>
    <div class="col-12 d-flex justify-content-center my-5">
        <app-loader></app-loader>
    </div>
</ng-template>

<ng-template #empty>
    <div class="col-12">
        <app-base-card className="d-flex flex-column align-items-center">
            <nz-empty
                class="mb-3 mt-7"
                nzNotFoundContent="No players found"
            ></nz-empty>
        </app-base-card>
    </div>
</ng-template>