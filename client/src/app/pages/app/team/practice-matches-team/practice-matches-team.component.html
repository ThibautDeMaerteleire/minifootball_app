<button
    class="btn op-7 bg-purple text-white br-3 mb-3"
    role="button"
    data-bs-toggle="modal"
    data-bs-target="#createPracticeMatchModal"
>
    Create practice match
</button>

<ng-template [ngIf]="!loading" [ngIfElse]="loadingTemplate" >
    <ng-template
        [ngIf]="practiceMatches && (practiceMatches[0].matches.length > 0 || practiceMatches[1].matches.length > 0)"
        [ngIfElse]="empty"
    >
        <div *ngFor="let type of practiceMatches" >
            <app-base-card
                className="mb-3 p-3"
                *ngIf="type.matches.length > 0"
            >
                <h3>{{type.name}}</h3>
                <div class="line bg-secondary"></div>
                <div *ngFor="let match of type.matches" class="row pt-3 px-2">
                    <small
                        *ngIf="match.date"
                        class="fw-6 text-label mb-3"
                    >
                        <span *ngIf="match.accepted || match.home_team.id == id">
                            {{match.date | date:"EEEE d MMMM"}}
                        </span>
                        <span *ngIf="!match.accepted && match.home_team.id != id">
                            {{match.date | date:"EEEE d MMMM HH:mm"}}
                        </span> 
                    </small>
                    <div
                        routerLink="/app/team/{{match.home_team.id}}"
                        class="col-5 d-flex align-items-center op-7"
                        [title]="match.home_team.name"
                        role="button"
                    >
                        <nz-avatar
                            nzIcon="team"
                            [nzSize]="48"
                            nzShape="circle"
                            [nzSrc]="assetsUrl + match.home_team.thumbnail"
                            [nzAlt]="'logo' + match.home_team.name"
                        >
                        </nz-avatar>
                        <span class="h6 mb-0 ms-3 text-uppercase shorten-text">{{match.home_team.name}}</span>
                    </div>
                    <div class="col-2 d-flex flex-column align-items-center justify-content-center text-center" >
                        <span *ngIf="(match.accepted || match.home_team.id == id) && match.date">
                            {{match.date | date:"HH:mm"}}
                        </span>
                        <span
                            *ngIf="(match.accepted || match.home_team.id == id) && !match.date"
                            title="No date yet"
                            class="fw-6 text-label"
                        >
                            VS
                        </span>
                        <button
                            *ngIf="!match.accepted && match.home_team.id != id"
                            class="btn op-7 border fw-6"
                            role="button"
                            (click)="acceptRequest(match.id)"
                        >
                            Accept request
                        </button>
                    </div>
                    <div
                        class="col-5 d-flex align-items-center justify-content-end op-7"
                        [title]="match.away_team.name"
                        routerLink="/app/team/{{match.away_team.id}}"
                        role="button"
                    >
                        <span class="h6 mb-0 me-3 text-uppercase shorten-text text-align-end">{{match.away_team.name}}</span>
                        <nz-avatar
                            nzIcon="team"
                            [nzSize]="48"
                            nzShape="circle"
                            [nzSrc]="assetsUrl + match.away_team.thumbnail"
                            [nzAlt]="'logo' + match.away_team.name"
                        >
                        </nz-avatar>
                    </div>
                    <div class="col-12 line mt-3"></div>
                </div>
            </app-base-card>
        </div>
    </ng-template>
</ng-template>


<div
    class="modal fade"
    id="createPracticeMatchModal"
    data-bs-keyboard="false"
    tabindex="-1"
    aria-labelledby="createPracticeMatchModalLabel"
    aria-hidden="true"
    (click)="createPracticeMatch.success"
>
    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
        <div class="modal-content br-3">
            <button
                type="button"
                class="btn-close position-absolute"
                data-bs-dismiss="modal"
                aria-label="Close"
                role="button"
                data-bs-target="#createPracticeMatchModal"
            >
            </button>
            <div class="modal-body py-5 px-5">
                <h3 class="mb-2">Create practice match</h3>
                <div class="line bg-secondary mb-3"></div>
                <ng-template [ngIf]="!createPracticeMatch.loading" [ngIfElse]="loadingTemplate">
                    <ng-template [ngIf]="!createPracticeMatch.success" [ngIfElse]="submitSuccessful">
                        <p>Choose a team and a date to send a request for a practice match.</p>
                        <app-small-custom-input
                            className="w-100 {{createPracticeMatch.error.length === 0 ? 'mb-3' : ''}}"
                            (changeValueEvent)="createPracticeMatch.search = $event.toString()"
                            (submitEvent)="searchOpponents()"
                            icon="search"
                            placeholder="Search"
                        >
                        </app-small-custom-input>
                        <p class="text-red my-2">
                            <small>
                                {{createPracticeMatch.error}}
                            </small>
                        </p>
                        <ng-template [ngIf]="createPracticeMatch.teams.length > 0" [ngIfElse]="emptyTeamsTemplate" >
                            <div
                                *ngFor="let team of createPracticeMatch.teams"
                                class="op-7 d-flex align-items-center p-3 border-bottom {{createPracticeMatch.selectedTeam && createPracticeMatch.selectedTeam.id === team.id ? 'bg-purple-bg' : ''}}"
                                role="button"
                                (click)="createPracticeMatch.selectedTeam = team"
                            >
                                <nz-avatar
                                    nzIcon="team"
                                    [nzSize]="48"
                                    nzShape="circle"
                                    [nzSrc]="assetsUrl + team.thumbnail"
                                    [nzAlt]="'logo' + team.name"
                                >
                                </nz-avatar>
                                <span class="h6 mb-0 ms-3 text-uppercase shorten-text">{{team.name}}</span>
                            </div>
                        </ng-template>
                        <p class="text-red my-2">
                            <small>
                                {{createPracticeMatch.error}}
                            </small>
                        </p>
                    </ng-template>
                </ng-template>
            </div>
            <div class="modal-footer">
                <div class="w-100 row">
                    <div class="col-4 d-flex align-items-center">
                        <nz-date-picker [(ngModel)]="createPracticeMatch.date" ></nz-date-picker>
                    </div>
                    <div class="col-4 d-flex align-items-center justify-content-center">
                        <p class="mb-0 shorten-text" >
                            against  <span class="fw-6">{{createPracticeMatch.selectedTeam ? createPracticeMatch.selectedTeam.name : '...'}}</span>
                        </p>
                    </div>
                    <div class="col-4 d-flex align-items-center justify-content-end">
                        <button
                            class="btn op-7 bg-purple text-white br-3"
                            role="button"
                            (click)="submitCreatePracticeMatch()"
                        >
                            Submit
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<ng-template #loadingTemplate>
    <div class="col-12 d-flex justify-content-center my-5">
        <app-loader></app-loader>
    </div>
</ng-template>

<ng-template #empty>
    <div class="col-12">
        <app-base-card className="d-flex flex-column align-items-center">
            <nz-empty
                class="mb-3 mt-7"
                nzNotFoundContent="No practice matches found"
            ></nz-empty>
        </app-base-card>
    </div>
</ng-template>

<ng-template #emptyTeamsTemplate>
    <div class="col-12">
        <app-base-card className="d-flex flex-column align-items-center">
            <nz-empty
                class="mb-3 mt-7"
                nzNotFoundContent="No teams found"
            ></nz-empty>
        </app-base-card>
    </div>
</ng-template>

<ng-template #submitSuccessful>
    <div class="w-100 d-flex flex-column align-items-center justify-content-center">
        <lottie-player
            src="https://assets5.lottiefiles.com/packages/lf20_ya4ycrti.json"
            background="transparent"
            speed="1"
            style="width: 300px; height: 300px;"
            autoplay
        >
        </lottie-player>
        <h1 class="mt-3 fw-7 text-center">Practice match request was created succesfully</h1>
    </div>
</ng-template>